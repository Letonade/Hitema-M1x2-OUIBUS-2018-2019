<!--
 Your First PWA Codelab (https://g.co/codelabs/pwa)

 Copyright 2019 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather PWA</title>
  <meta name="codelab" content="your-first-pwa-v3">
  <link rel="stylesheet" type="text/css" href="/styles/inline.css">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  <!-- CODELAB: Add iOS meta tags and icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Weather PWA">
  <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png">
  <!-- CODELAB: Add link rel manifest -->
  <link rel="manifest" href="/manifest.json">
  <!-- CODELAB: Add iOS meta tags and icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Weather PWA">
  <link rel="apple-touch-icon" href="/images/icons/icon-152x152.png">
  <!-- CODELAB: Add description here -->
  <meta name="description" content="A sample weather app">
  <!-- CODELAB: Add meta theme-color -->
  <meta name="theme-color" content="#2F3BA2" />

</head>
<body>

  <div id="main-map">
    <div id="map"></div>
  </div>

  <script>
    function maPosition(position) {
      var infopos = "Position déterminée :\n";
      infopos += "Latitude : "+position.coords.latitude +"\n";
      infopos += "Longitude: "+position.coords.longitude+"\n";
      infopos += "Altitude : "+position.coords.altitude +"\n";
    //  document.getElementById("infoposition").innerHTML = infopos;
    }

    if(navigator.geolocation)
      navigator.geolocation.getCurrentPosition(maPosition);
  </script>

  <script src="/scripts/app.js"></script>
  <!-- CODELAB: Add the install script here -->
    <script src="/scripts/install.js"></script>
  <script>
    // CODELAB: Register service worker.
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
            .then((reg) => {
              console.log('Service worker registered.', reg);
            });
      });
    }
  </script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    function start() {
      // 2. Initialize the JavaScript client library.
      gapi.client.init({
        'apiKey': 'AIzaSyBiTJkGjm3TpbQcvEfBuCzWg1iIPQ5GOyM',
        // clientId and scope are optional if auth is not required.
        'clientId': '951321888559-4d55epa4gbp8h16044e3jvd6gs3lnkbi.apps.googleusercontent.com',
        'scope': 'profile',
      }).then(function() {
        // 3. Initialize and make the API request.
        return gapi.client.request({
          'path': 'https://people.googleapis.com/v1/people/me?requestMask.includeField=person.names',
        })
      }).then(function(response) {
        console.log(response.result);
      }, function(reason) {
        //console.log(reason);
        console.log('Error: ' + reason.details);
      });
    };
    // 1. Load the JavaScript client library.
    gapi.load('client', start);
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script>

    function initMap() {
      // Position par défaut
      var centerpos = new google.maps.LatLng(48.579400,7.7519);

      // Ansi que des options pour la carte, centrée sur latlng
      var optionsGmaps = {
        center:centerpos,
        navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoom: 15
      };

      map = new google.maps.Map(document.getElementById('map'), optionsGmaps);
    }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBiTJkGjm3TpbQcvEfBuCzWg1iIPQ5GOyM&callback=initMap"
          ></script>
  <script type="text/javascript" charset="UTF-8" src="https://maps.google.com/maps-api-v3/api/js/37/3/common.js"></script>
  <script type="text/javascript" charset="UTF-8" src="https://maps.google.com/maps-api-v3/api/js/37/3/util.js"></script>
  <script type="text/javascript" charset="UTF-8" src="https://maps.google.com/maps-api-v3/api/js/37/3/map.js"></script>
  <script type="text/javascript" charset="UTF-8" src="https://maps.google.com/maps-api-v3/api/js/37/3/onion.js"></script>
  <script type="text/javascript" charset="UTF-8" src="https://maps.google.com/maps-api-v3/api/js/37/3/controls.js"></script>
    <script>

    // Initialisation de la carte avec les options
    //var map = new google.maps.Map(document.getElementById("map"), optionsGmaps);

      // Fonction de callback en cas de succès
      function affichePosition(position) {

        var infopos = "Position déterminée : <br>";
        infopos += "Latitude : "+position.coords.latitude +"<br>";
        infopos += "Longitude: "+position.coords.longitude+"<br>";
        infopos += "Altitude : "+position.coords.altitude +"<br>";
        //   document.getElementById("maposition").innerHTML = infopos;

        // On instancie un nouvel objet LatLng pour Google Maps
        var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

        // Ajout d'un marqueur à la position trouvée
        var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          title:"Vous êtes ici"
        });

        map.panTo(latlng);

      }
      // Fonction de callback en cas d’erreur
      function erreurPosition(error) {
        console.log(error);
        alert("err");
        var info = "Erreur lors de la géolocalisation : ";
        switch(error.code) {
          case error.TIMEOUT:
            info += "Timeout !";
            break;
          case error.PERMISSION_DENIED:
            info += "Vous n’avez pas donné la permission";
            break;
          case error.POSITION_UNAVAILABLE:
            info += "La position n’a pu être déterminée";
            break;
          case error.UNKNOWN_ERROR:
            info += "Erreur inconnue";
            break;
        }
        document.getElementById("maposition").innerHTML = info;
      }

    if(navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(affichePosition,erreurPosition);

    } else {

      alert("Ce navigateur ne supporte pas la géolocalisation");

    }


  </script>



</body>
</html>
